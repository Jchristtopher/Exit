# Exit
#include &lt;GUIConstantsEx.au3> #include &lt;WindowsConstants.au3>  Opt("GUIOnEventMode", 1)  #region GUI $GUI = GUICreate("GUI") GUISetOnEvent($GUI_EVENT_CLOSE, "_Exit")  GUICtrlCreateLabel("You can use me as a normal GUI, except that I intercept the WM_CLOSE message," &amp; _         " which is also sent by the taskmanager when you press the ""End task"" button (not the ""End process"" one).", 10, 10, 380, 40)  GUIRegisterMsg($WM_CLOSE, "WM_CLOSE") GUISetState() #endregion GUI  While 1     Sleep(1000) WEnd  Func WM_CLOSE($hWnd, $iMsg, $wParam, $lParam)     ;do your last actions here before the script exits      MsgBox(48, "Warning", "The taskmanager wants to kill me !" &amp; @CRLF &amp; "Press OK to exit", 0, $GUI)     ;if you let the MsgBox showed for few seconds, the taskmanager will see that the script is hanging and will suggest you to kill the script      Return $GUI_RUNDEFMSG EndFunc   ;==>WM_CLOSE  Func _Exit()     Exit EndFunc   ;==>_Exit
